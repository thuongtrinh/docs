
--------------------------------------------------------------------------------------------------------

Truy c·∫•p quy·ªÅn root trong linux
sudo su -

chuy·ªÉn ƒë·∫øn t√†i kho·∫£n ƒë∆∞·ª£c t·∫°o
su - thuongtx

2. Check your current Linux version with:
$ uname -r

----------------------------------------------------------------------------------------------------

1. Ch·ªânh kh√¥ng cho ph√©p truy c·∫≠p t·ª´ xa ƒë·∫øn server b·∫±ng password,...
vi /etc/ssh/sshd_config
service sshd restart

B1: goto -> /etc/ssh/
vi sshd_config

B2: Ch·ªânh c√°c config

B3:    $ systemctl restart sshd
/ho·∫∑c/ $ service sshd restart

=============================================
2. C·∫•p th√™m quy·ªÅn cho m·ªôt user b·∫±ng command:
$ visudo
=============================================
cat /etc/group  => xem c√°c groups 
=============================================

----------------------------------------------------------------------------------------------------

5. T·∫°o user/pass cho account linux
useradd thuongtx
passwd thuongtx

Ex:
thuongtx
123456

6. T·∫°o public key & private key (cho m·ªôt user account ƒë·ªÉ k·∫øt n·ªëi ƒë·∫øn server)
ssh-keygen -t rsa
cd /home/yuki/.ssh
mv id_rsa.pub authorized_keys
chmod 600 authorized_keys

* Copy private key v·ªÅ m√°y t√≠nh: id_rsa.pub = authorized_keys

L∆∞u √Ω: Putty v√¨ c√≥ s·ª± kh√¥ng t∆∞∆°ng th√≠ch gi·ªØa OpenSSH key v√† Putty key n√™n tr∆∞·ªõc khi s·ª≠ d·ª•ng c·∫ßn chuy·ªÉn ƒë·ªïi ƒë·∫øn \id_rsa.ppk 

thgtx.com

----------------------------------------------------------------------------------------------------

0. vi hello.txt -> t·∫°o v√† ghi file
   less hello.txt -> ƒë·ªçc file

1. T·∫°o th∆∞ m·ª•c  a/b/c
mrdir -p a/b/c -> t·∫°o nhi·ªÅu th∆∞ m·ª•c v√≠ d·ª•: a,b,c

2. X√≥a th∆∞ m·ª•c hanoi v√† t·∫•t c·∫£ data trong th∆∞ m·ª•c hanoi
rm -Rf hanoi/

3. Copy to√†n b·ªô file v√† th∆∞ m·ª•c trong hanoi -> haiphong (C√≥ ti·ªÅn t·ªë: -Rf th√¨ m·ªõi copy c·∫£ th∆∞ m·ª•c v√† file)
cp -Rf hanoi/* haiphong/*

3.1 cp -rf hanoi haiphong/   -> Copy th∆∞ m·ª•c "hanoi" v√†o th∆∞ m·ª•c "haiphong" 

4. L·ªánh li·ªát k√™ t·∫•t c·∫£ nh·ªØng g√¨ m√¨nh ƒë√£ l√†m
history
history | less

----------------------------------------------------------------------------------------------------

7. C√∫ ph√°p l·ªánh userdel

userdel USERNAME

userdel -r username
sudo killall -u username
userdel -f username

* ƒê·ªÉ x√≥a ng∆∞·ªùi d√πng b·∫±ng l·ªánh userdel, b·∫°n c·∫ßn ph·∫£i ƒëƒÉng nh·∫≠p b·∫±ng root ho·∫∑c ng∆∞·ªùi d√πng c√≥ quy·ªÅn truy c·∫≠p sudo .

su userdel bao  -> x√≥a user bao login bang user thuongtx (nh·ªõ c√≥ sudo ph√≠a tr∆∞·ªõc)

X√≥a user:
userdel -rf username

Nh·ªõ x√≥a: 
rm -rf  /home/thuongtx
rm -rf  /var/spool/mail/thuongtx


(hoac: rm -r -f thuongtx)
userdel: thuongtx mail spool (/var/spool/mail/thuongtx) not found
userdel: thuongtx home directory (/home/thuongtx) not found


----------------------------------------------------------------------------------------------------

usermod: cannot open /etc/shadow 
=> Ok, this fixed it:

root@debian:~# chattr -a /etc/passwd
root@debian:~# chattr -a /etc/shadow

----------------------------------------------------------------------------------------------------
- Li·ªát k√™ t·∫•t c·∫£ c√°c groups
less /etc/group

-T·∫°o user/group v√† ph√¢n quy·ªÅn file v√† folder tr√™n AWS EC2 Linux
+ T·∫°o user
useradd bao
passwd bao

+ T·∫°o group
groupadd ketoan
groupadd nhansu

-Th√™m user v√†o group
usermod -a -G <groupname> <username>
Ex: usermod -a -G ketoan bao

- Ki·ªÉm tra th√™m user c√≥ n·∫±m trong group ch∆∞a
id <username>

- Ki·ªÉm tra permission hi·ªán t·∫°i: ls -la

- Rule permission:
d rwx r-x r-x

d: directory
rwx: user
r-x: group
r-x: c√°c quy·ªÅn public

- Set quy·ªÅn cho file v√† folder
chmod [quy·ªÅn][t√™n file ho·∫∑c th∆∞ m·ª•c]
v√≠ d·ª•: chmod -Rf 777 <ketoan>
 -Rf -> c√≥ nghƒ©a change quy·ªÅn full c√°c file / th∆∞ m·ª•c con b√™n trong

- G√°n quy·ªÅn c·ªßa group v√†o trong folder-data
ex2: chown -Rf root:ketoan ketoan-data/
     chown -Rf :ketoan ketoan-data/

- G√°n quy·ªÅn (s·ªü h·ªØu) cho user v√†o trong group/thu muc
chown [ten user]:[ten nhom] [ten file hoac thu muc]
vd: chown -Rf bao:ketoan ketoan-data/

-Thay ƒë·ªïi ng∆∞·ªùi d√πng ch·ªß s·ªü h·ªØu c·ªßa m·ªôt t·∫≠p tin ho·∫∑c th∆∞ m·ª•c:
chown user file

vd: chown bao /var/www/bao  => set quyen bao cho thu muc bao

-Thay ƒë·ªïi ng∆∞·ªùi d√πng ch·ªß s·ªü h·ªØu v√† nh√≥m c·ªßa m·ªôt t·∫≠p tin ho·∫∑c th∆∞ m·ª•c:
chown user:group file

-Thay ƒë·ªïi ƒë·ªá quy ch·ªß s·ªü h·ªØu c·ªßa m·ªôt th∆∞ m·ª•c v√† t·∫•t c·∫£ n·ªôi dung b√™n trong c·ªßa n√≥:
chown -R user folder

-Thay ƒë·ªïi ch·ªß s·ªü h·ªØu c·ªßa m·ªôt t·∫≠p tin ho·∫∑c th∆∞ m·ª•c:
chgrp group file
ex: chgrp root test01

----------------------------------------------------------------------------------------------------

B√†i 6: T·∫°o web server Apache tr√™n AWS EC2 Linux

- C√†i ƒë·∫∑t apache httpd ch·∫°y port 80
yum install httpd -y

- Start server: start httpd.service
- C√†i telnet:   yum install telnet
- Check c√†i ƒë·∫∑t httpd b·∫±ng telnet: telnet localhost 80

* M·ªû FIREWALL port 80
<NameVirtualHost*:80>

<VirtualHost *:80>
    ServerAdmin webmaster@yourdomain.com
    DocumentRoot "<ƒë∆∞·ªùng d·∫´n th∆∞ m·ª•c s·∫Ω ƒë∆∞·ª£c g·ªçi t·ªõi khi truy c·∫≠p v√†o youdomain.com"
    ServerName  youdomain.com
    ErrorLog "logs/yourdomain.com-error.log"
    CustomLog "logs/yourdomain.com-access.log" common
    <Directory "<ƒë∆∞·ªùng d·∫´n th∆∞ m·ª•c">
        Options FollowSymLinks
        AllowOverride All
        DirectoryIndex index.php
        Require all granted
    </Directory>
</VirtualHost>

EX:
<VirtualHost *:80>
    ServerAdmin root@localhost
    DocumentRoot /var/www/html/web-demo
    <Directory "/var/www/html/web-demo">
        Order deny,allow
		Allow from all
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>

- Th∆∞ m·ª•c web: cd /var/wwww/html/
t·∫°o web-demo

-Xem c·∫•u h√¨nh m·∫∑c ƒë·ªãnh: user apache, group apache v√† c·∫•u h√¨nh VirtualHost
vi /etc/httpd/conf/httpd.conf

-G√°n group apache v·ªõi th∆∞ m·ª•c web-demo
chown -Rf :apache web-demo/

----------------------------------------------------------------------------------------------------

B√†i 7: C√†i SSL mi·ªÖn ph√≠ cho web server Apache tr√™n AWS EC2 Linux

3. taoj private key
mkdir -p /etc/httpd/conf/web-demo-ssl
cd etc/httpd/conf/web-demo-ssl
openssl genrsa > server.key

4. Ti·∫øp theo t·∫°o CSR, file CSR n√†y ƒë∆∞·ª£c s·ª≠ d·ª•ng khi c∆° quan c·∫•p ch·ª©ng ch·ªâ cho m√°y ch·ªß
openssl req	-new server.key >  server.csr
...vvv...etc...


Step1: C√†i ƒë·∫∑t mod ssl cho Apache
yum -y install mod_ssl

Step2:C√†i ƒë·∫∑t openssl
yum install openssl

Step3: T·∫°o private key
mkdir -p /etc/httpd/conf/tinhocthatladongian-ssl
cd /etc/httpd/conf/tinhocthatladongian-ssl
openssl genrsa > server.key

----------------
mkdir -p /etc/httpd/conf/web-demo-ssl
cd etc/httpd/conf/web-demo-ssl
openssl genrsa > server.key
----------------

Step4: Ti·∫øp theo, t·∫°o file CSR, file CSR n√†y ƒë∆∞·ª£c s·ª≠ d·ª•ng khi c∆° quan c·∫•p ch·ª©ng ch·ªâ c·∫•p ch·ª©ng ch·ªâ cho m√°y ch·ªß
openssl req -new -key server.key > server.csr
	
----------------
openssl req        -new server.key >  server.csr
----------------

Step5: G·ª≠i file server.csr ·ªü tr√™n cho nh√† cung c·∫•p SSL(n∆°i b·∫°n mu·ªën mua SSL) b·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c c√°c file cerfiticate
v√≠ d·ª•n m√¨nh d√πng sslforfree ƒë·ªÉ th·ª±c h√†nh b√†i n√†y

Step6: Copy c√°c file cerfiticate nh·∫≠n ƒë∆∞·ª£c v√†o th∆∞ m·ª•c /etc/httpd/conf/tinhocthatladongian-ssl v√† change quy·ªÅn cho c√°c file n√†y
chown root:root  ca_bundle.crt
chown root:root  certificate.crt
chmod 600  ca_bundle.crt chown 600  certificate.crt


Step7: C·∫•u h√¨nh apache
<VirtualHost _default_:443>
    SSLEngine On
    ServerAdmin info@coderhanoi.com
    DocumentRoot "/var/www/html/tinhocthatladongian/"
    ServerName coderhanoi.com
    SSLCertificateFile "/etc/httpd/conf/tinhocthatladongian-ssl/certificate.crt"
    SSLCertificateChainFile "/etc/httpd/conf/tinhocthatladongian-ssl/ca_bundle.crt"
    SSLCertificateKeyFile "/etc/httpd/conf/tinhocthatladongian-ssl/server.key"
    <Directory "/var/www/html/tinhocthatladongian/">     
		 Order deny,allow        
		 Allow from all        
		 AllowOverride All        
		 Require all granted
   </Directory>
</VirtualHost>

Step:  Kh·ªüi ƒë·ªông l·∫°i apache
service restart httpd

Step9:  M·ªü c·ªïng 443 cho ssl tr√™n firewall

----------------------------------------------------------------------------------------------------

B√†i 8: C√†i ƒë·∫∑t FTP Server tr√™n AWS EC2 Linux

---------------------------------
Tin h·ªçc th·∫≠t l√† ƒë∆°n gi·∫£n - B·∫°n c√≥ th·ªÉ d√πng c√∫ ph√°p n√†y ƒë·ªÉ ch·ªâ cho ph√©p user login v√†o FTP
usermod -s /sbin/nologin username
---------------------------------

1. C√†i ƒë·∫∑t FTP
yum -y install vsftpd

2. Th√™m c√°c d√≤ng l·ªánh sau v√†o /etc/vsftpd/vsftpd.conf
pam_service_name=vsftpd
userlist_enable=YES
tcp_wrappers=NO
pasv_enable=YES
pasv_address=18.136.200.90
pasv_min_port=60001
pasv_max_port=60010
force_dot_files=YES
use_localtime=YES
allow_writeable_chroot=YES
listen=YES
listen_ipv6=NO
pasv_addr_resolve=NO

3. B·ªè c√°c comment sau trong /etc/vsftpd/vsftpd.conf
- B·ªè comment
chroot_local_user=NO
chroot_list_enable=YES
chroot_list_file=/etc/vsftpd/chroot_list

Th√™m d√≤ng
user_config_dir=/etc/vsftpd/user_conf

* Test th·ª≠ ch·∫°y ch∆∞a?
=> service vsftpd start
telnet localhost 21
quit

4. edit file sau v√† th√™m v√†o user ftp-user
vi /etc/vsftpd/chroot_list
frp-user
bao

-> ƒë·∫∑t c√°c username v√†o file n√†y

5. T·∫°o th∆∞ m·ª•c
mkdir /etc/vsftpd/user_conf

6. T·∫°o file /etc/vsftpd/user_conf/<username>
vi /etc/vsftpd/user_conf/bao

7. ƒêi·ªÅn n·ªôi dung v√†o file -> /etc/vsftpd/user_conf/bao
local_root=/var/www/bao

8. C·∫•p quy·ªÅn
mkdir -p  /var/www/bao
chown bao /var/www/bao   -> G√°n user cho folder
chmod 775 /var/www/bao
=> service vsftpd restart

9. M·ªüi port 21, 60001-60010 tr√™n Firewall c·ªßa AWS

10. Test k·∫øt n·ªëi
   M·ªü Winscp test login FTP v·ªõi user bao

----------------------------------------------------------------------------------------------------

B√†i 9: C√†i database MySQL ph√¢n quy·ªÅn User tr√™n AWS EC2 Linux

1. Ki·ªÉm tra xem mariadb c√≥ c√†i tr√™n EC2/linux kh√¥ng
yum list installed | grep mariadb

1.1 x√≥a DB mariadb 
yum remove mariadb-libs

* x√≥a DB mysql 
sudo yum remove mysql mysql-server    #CentOS and RedHat systems 
sudo apt remove mysql mysql-server    #Ubuntu and Debian systems 
sudo dnf remove mysql mysql-server    #Fedora 22+ systems 

2. Ki·ªÉm tra xem MySQL ƒë√£ ƒë∆∞·ª£c c√†i ƒë·∫∑t hay ch∆∞a
yum list installed | grep mysql

3. Th√™m Repository mysql8.0 v√†o th∆∞ vi·ªán yum(trong Repository 8 n√†y th√¨ bao g·ªìm c·∫£ version 5.7)
yum localinstall https://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm -y

4. M√¨nh s·∫Ω c√†i mysql 5.7 n√™n m√¨nh s·∫Ω disable mysql 5.8 ƒëi b·∫±ng l·ªánh
yum-config-manager --disable mysql80-community

5. Enable mysql 5.7 l√™n b·∫±ng l·ªánh
yum-config-manager --enable mysql57-community

6. Confirm th√¥ng tin version
yum info mysql-community-server

7. C√†i ƒë·∫∑t
yum install mysql-community-server -y

8. Ki·ªÉm tra version
mysqld --version 

9. Kh·ªüi ƒë·ªông
systemctl start mysqld.service

10. Auto start-up
systemctl enable mysqld.service

11. Xem status tr·∫°ng th√°i xem ƒë√£ ch·∫°y hay ch∆∞a
systemctl status mysqld.service

12. Xem m·∫≠t kh·∫©u root m·∫∑c ƒë·ªãnh
cat /var/log/mysqld.log | grep password

13. Thi·∫øt l·∫≠p l·∫ßn ƒë·∫ßu cho MySQL
mysql_secure_installation

14. Xem charset hi·ªán t·∫°i
mysql -uroot -p
show global variables like 'character%';

15. Set default charset cho MySQL
vi /etc/my.cnf
[mysqld]
character_set_server=utf8

[client]
default-character-set=utf8

16. T·∫°o database
create database sysprodb character set UTF8 collate utf8_bin;

17. T·∫°o local user
CREATE USER 'thuongtx'@'localhost' IDENTIFIED BY 'Abc123456@';

G√°n quy·ªÅn cho ph√©p qu·∫£n l√Ω database sysprodb
GRANT ALL PRIVILEGES ON sysprodb.* TO thuongtx@localhost;

18. T·∫°o remote user
CREATE USER 'thuongtx'@'%' IDENTIFIED BY 'Abc123456@';

G√°n quy·ªÅn cho ph√©p qu·∫£n l√Ω database sysprodb
GRANT ALL PRIVILEGES ON sysprodb.* TO thuongtx@'%';

19. M·ªü firewall port 3306
K·∫øt n·ªëi th·ª≠

=> Passwd new: Abc123456@

----------------------------------------------------------------------------------------------------

B√†i 10: AWS IAM t·∫°o ng∆∞·ªùi d√πng qu·∫£n l√Ω AWS
1. T·∫°o user
2. T·∫°o group
3. T·∫°o role
4. T·∫°o policy
5. T·∫°o MFA

user: bao

1. C√†i ƒë·∫∑t AWS windows command line -> AWSCLIV2
aws --version
C·∫•u h√¨nh: aws configure

----------------------------------------------------------------------------------------------------

B√†i 11: AWS S3 d·ªãch v·ª• qu·∫£n l√Ω files

aws configure

üèÉüèº‚Äç‚ôÄÔ∏è Lab document
aws s3 ls  hi·ªÉn th·ªã list bucket
aws s3 ls s3://{buckname} --recursive   -> Liet ke tat ca
aws s3 ls s3://bucket-first1 --recursive --human-readable --summarize

aws s3 ls s3://{buckname}/{path} dir bucket
aws s3 mb s3://{buckname}  t·∫°o bucket
aws s3 rb s3://{buckname}  x√≥a bucket tr∆∞·ªùng h·ª£p bucket c√≥ data
aws s3 rb s3://{buckname} --force x√≥a bucket tr∆∞·ªùng h·ª£p bucket kh√¥ng c√≥ d·ªØ li·ªáu
aws s3 sync {folder path} s3://{buckname}/{path}   ƒê·ªìng b·ªô l√™n bucket tr∆∞·ªùng h·ª£p n√†y ch·ªâ th√™m v√† update m√† kh√¥ng x√≥a
aws s3 sync {folder path} s3://{buckname}/{path} --delete ƒê·ªìng b·ªô v·ªõi th∆∞ m·ª•c local s·∫Ω x√≥a file n·∫øu kh√¥ng t·ªìn t·∫°i ·ªü local
aws s3 cp {file path} s3://{buckname}/{path}    copy file t·ª´ local l√™n s3 (ho·∫∑c ng∆∞·ª£c l·∫°i l√† t·∫£i v·ªÅ)
aws s3 mv {file path} s3://{buckname}/{path}    move file t·ª´ local l√™n s3 (ho·∫∑c ng∆∞·ª£c l·∫°i l√† t·∫£i v·ªÅ)
aws s3 rm s3://{buckname}/{file path} x√≥a file
aws s3 rm s3://{buckname}/{folder path} --recursive  x√≥a th∆∞ m·ª•c aws s3 ls  hi·ªÉn th·ªã list bucket

rename=move

Ex:
aws s3 cp "C:\Users\admin\Downloads\Photo\sen.jpg" s3://bucket-second/flowers
aws s3 rm s3://bucket-second/flowers


aws s3 sync s3://bucket-first1 C:\Users\admin\Downloads\Photo\home\new -> ƒë·ªìng b·ªô (download) tr√™n bucket v·ªÅ local
 
------------------------------------------------------------------------

cat credentials  
cat config
tree

----------------------------------------------------------------------------------------------------

B√†i 12: AWS RDB C∆° s·ªü d·ªØ li·ªáuC√†i EC2 v√† wordpress ƒë·ªÉ test RDS

Lab document
1. T·∫°o DB MySQL RDS
2. T·∫°o k·∫øt n·ªëi t·ªõi DB t·ª´ xa
3. C√†i EC2 v√† wordpress ƒë·ªÉ test RDS
#!/bin/bash
yum install httpd php php-mysql -y
cd /var/www/html
wget https://wordpress.org/wordpress-5.1.1.tar.gz
tar -xzf wordpress-5.1.1.tar.gz
cp -r wordpress/* /var/www/html/
rm -rf wordpress
rm -rf wordpress-5.1.1.tar.gz
chmod -R 755 wp-content
chown -R apache:apache wp-content
service httpd start
chkconfig httpd on

---------------------------------------------------------------------------------------------------

B√†i 13: Elastic IP Address c·∫•u h√¨nh IP tƒ©nh tr√™n AWS/EC2

1. C·∫•u h√¨nh Virtual host http th∆∞·ªùng
server {
    listen        80;
    server_name   tinhocthatladongian.coderhanoi.com;
    access_log    /var/log/nginx/tinhocthatladongian.coderhanoi.com.access.log main;
    error_log    /var/log/nginx/tinhocthatladongian.coderhanoi.com.error.log;
    root /var/www/tinhocthatladongian.coderhanoi.com;
    index index.php;
    location ~ \.php$ {
        root           /var/www/tinhocthatladongian.coderhanoi.com;        
  fastcgi_pass   unix:/run/php-fpm/www.sock;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include        fastcgi_params;
    }
}

2. C·∫•u h√¨nh Virtual host ssl https
 server {
    listen 80;
 listen 443;
 
 ssl on;
 ssl_certificate      /path/tinhocthatladongian.coderhanoi.com.crt;
 ssl_certificate_key  /path/tinhocthatladongian.coderhanoi.com.key;
 
    server_name   tinhocthatladongian.coderhanoi.com;
    access_log    /var/log/nginx/tinhocthatladongian.coderhanoi.com.access.log main;
    error_log    /var/log/nginx/tinhocthatladongian.coderhanoi.com.error.log;
    root /var/www/tinhocthatladongian.coderhanoi.com;
    index index.php;
    location ~ \.php$ {
        root           /var/www/tinhocthatladongian.coderhanoi.com;        
  fastcgi_pass   unix:/run/php-fpm/www.sock;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include        fastcgi_params;
    }
}


nslookup google.com
nslookup -type=ns google.com
---------------------------------------------------------------------------------------------------

B√†i 14: C√†i ƒë·∫∑t web server NginxTr√™n AWS/EC2

Cai Nginx 
- Update yum
	yum -y update 
- Cai dat nginx 
	amazon-linux-extras install nginxl.12 -y
- Check version
	nginx -V
- Start Nginx 
	systemctl start nginx.service 
- Cho Nginx vao start-up 
	systemctl enable nginx.service 

0. Ca'u hinh Virtual host Tao file cau hinh host 
	vi /etc/nginx/conf.d/tinhocthatladongian.coderhanoi.com.conf

1. C·∫•u h√¨nh Virtual host http th∆∞·ªùng
server {
    listen        80;
    server_name   tinhocthatladongian.coderhanoi.com;
    access_log    /var/log/nginx/tinhocthatladongian.coderhanoi.com.access.log main;
    error_log    /var/log/nginx/tinhocthatladongian.coderhanoi.com.error.log;
    root /var/www/tinhocthatladongian.coderhanoi.com;
    index index.php;
    location ~ \.php$ {
        root           /var/www/tinhocthatladongian.coderhanoi.com;        
        fastcgi_pass   unix:/run/php-fpm/www.sock;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include        fastcgi_params;
    }
}

2. C·∫•u h√¨nh Virtual host ssl https
 server {
 listen 80;
 listen 443;
 
 ssl on;
 ssl_certificate      /path/tinhocthatladongian.coderhanoi.com.crt;
 ssl_certificate_key  /path/tinhocthatladongian.coderhanoi.com.key;
 
    server_name   tinhocthatladongian.coderhanoi.com;
    access_log    /var/log/nginx/tinhocthatladongian.coderhanoi.com.access.log main;
    error_log    /var/log/nginx/tinhocthatladongian.coderhanoi.com.error.log;
    root /var/www/tinhocthatladongian.coderhanoi.com;
    index index.php;
    location ~ \.php$ {
        root           /var/www/tinhocthatladongian.coderhanoi.com;        
        fastcgi_pass   unix:/run/php-fpm/www.sock;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include        fastcgi_params;
    }
}

###Command about nginx:

- cho nginx v√†o startup
systemctl enable nginx.service

- Star nginx
systemctl start nginx.service

Win:
start nginx               # b·∫≠t nginx
nginx -s stop             # t·∫Øt nginx
nginx -s reload           # t·∫£i l·∫°i c·∫•u h√¨nh nginx (khi file c·∫•u h√¨nh thay ƒë·ªïi v√† b·∫°n mu·ªën apply s·ª± thay ƒë·ªïi ƒë√≥ lu√¥n)

Linux:
service nginx status

sudo systemctl start nginx 
sudo systemctl stop nginx 
sudo systemctl restart nginx

ym -y update

--------------------------------------------JDK in linux-------------------------------------------------------

vi /etc/profile

# OpenJDK 16
JAVA_HOME=/usr/java/openjdk/jdk-16.0.1
PATH=$PATH:$HOME/bin:$JAVA_HOME/bin
export JAVA_HOME
export PATH

*If JDK is not installed on your system, use the below-mentioned commands to configure the java commands.
sudo update-alternatives --install "/usr/bin/java" "java" "/usr/java/openjdk/jdk-16.0.1/bin/java" 1


--------------------------------------------------------------------------------------------------------------
How to Find if Linux is Running on 32-bit or 64-bit

uname -a 
uname -m 
arch

---------------------------------------------------------------------------------------------------

16 Commands to Check Hardware Information on Linux
lscpu
free -m
cat /proc/cpuinfo
cat /proc/meminfo

---------------------------------------------------------------------------------------------------

How to check remaining space in storage device EC2
df -hT /dev/xvda1

---------------------------------------------------------------------------------------------------

psql --version

yum -y install telnet

su - postgres

psql postgres
\l  -> hi·ªÉn th·ªã t·∫•t c·∫£ c√°c database

CREATE DATABASE employeemanager;

v·ªã tr√≠: postgresql.conf  
/var/lib/pgsql/13/data

1. postgresql.conf
listen_addresses = '*'
uncomment this line and change localhost to *

2. pg_hba.conf
host    all             all             0.0.0.0/0

sudo systemctl restart postgresql-13.service   -> restart postgresql
sudo systemctl status postgresql-13.service    -> check status
hoac: service  postgresql-13  status


ALTER USER postgres PASSWORD '123456';   -> thay ƒë·ªïi pass default

---------------------------------------------------------------------------------------------------

172-31-15-118

ALTER USER postgres PASSWORD '123456';

curl -X GET \
  -H "Content-type: application/json" \
  -H "Accept: application/json" \
  "http://52.77.221.165:8180/employee/all"

---------------------------------------------------------------------------------------------------

ng build
/usr/share/nginx/html/employee-app

---------------------------------------------------------------------------------------------------

T·ª± ƒë·ªông c√†i web server khi t·∫°o EC2

#!/bin/bash
yum update -y
yum install httpd -y
chkconfig httpd on
service httpd start
cd /var/www/html
echo "Hello Tin Hoc That La Don Gian" } index.html


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-------------------------------------------AWS AND DOCKER--------------------------------------------------------
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


B√†i 25: Docker 1 / DevOps Docker l√† g√¨? c√†i docker v√† docker-compose tr√™n EC2/AWS v√† Windows

C√†i docker v√† docker-compose tr√™n EC2/AWS

sudo yum update -y
sudo yum install -y docker
sudo service docker start
sudo usermod -a -G docker ec2-user

- C√†i docker-compose
sudo curl -L "https://github.com/docker/compose/rel... -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

-----------------------------------------------------------------------------------------------------------------

B√†i 26: Docker 2/DevOps tri·ªÉn khai t·∫°o Image, Container&Docker Hub cho kh√°ch h√†ng v√† ƒë·ªôi l·∫≠p tr√¨nh

 Lab document
C√°c l·ªánh v·ªõi image
- T√¨m image ƒë·ªÉ c√†i ƒë·∫∑t
docker search centos
- List c√°c image ƒëang c√≥
docker image ls
- X√≥a image
sudo docker rmi [Image ID]
Ch√∫ √Ω: C√°c image m√† c√≥ container ƒëang ch·∫°y th√¨ s·∫Ω kh√¥ng x√≥a ƒë∆∞·ª£c m√† ph·∫£i x√≥a container li√™n quan t·ªõi n√≥ tr∆∞·ªõc
- Pull image v·ªÅ
docker pull centos:7

L√†m vi·ªác v·ªõi container

- Ch·∫°y 1 container t·ª´ image
docker run --privileged -d -p 80:80 [Image Name] /sbin/init
docker run --privileged -d -p 80:80 centos:7 /sbin/init

- V√†o container ƒë·ªÉ ch·∫°y l·ªánh
docker exec -it [Container ID] /bin/bash 

- C√†i ƒë·∫∑t apache
yum -y install httpd
systemctl start httpd
systemctl enable httpd

echo "Hello Tin Hoc That La Don Gian" } /var/www/html/index.html

- Tho√°t ra kh·ªèi container
exit

- T·∫°o image ƒë·ªÉ tri·ªÉn khai cho m√°y kh√°c
docker commit -m "Comment" -a "T√°c gi·∫£"  [Container ID] [Image Name]
docker commit -m "Centos Project01" -a "Nguyen Quoc Bao" d452f1a1b69d tinhocthatladongian/project01:v1

- ƒêƒÉng nh·∫≠p v√†o docker/hub
docker login

- ƒê∆∞a image l√™n docker hub ƒë·ªÉ m·ªçi ng∆∞·ªùi c√πng s·ª≠ d·ª•ng
docker push [T√™n image]
docker push tinhocthatladongian/project01:v1
 
- Check c√°c container ƒëang ch·∫°y
sudo docker ps -a

- Xem tr·∫°ng th√°i container
docker container ls -a

- X√≥a containner
sudo docker rm [Container ID]

- Stop container
docker container stop [Container ID]

- Restart container
docker container restart [Container ID]

- Pause container
docker container pause  [Container ID]

- Truy c·∫≠p v√†o c√°c container ƒëang ch·∫°y
docker container attach [Container ID]


- L·ªánh stop to√†n b·ªô container
docker stop $(docker ps -a -q)

- L·ªánh x√≥a to√†n b·ªô container
docker rm $(docker ps -a -q)

- L·ªánh x√≥a to√†n b·ªô image
docker rmi -f $(docker images -a -q)

-----------------------------------------------------------------------------------------------------------------

B√†i 27:DevOps Docker 3 / Dockerfile

Lab document
1. T·∫°o Dockerfile

# Get base image
FROM centos:7

# Author
MAINTAINER "Nguyen Quoc Bao"

#Cai dat apache
RUN yum update -y
RUN yum install -y sudo
RUN yum install -y epel-release
RUN yum install -y http://rpms.famillecollet.com/enterpr...
RUN yum clean all
RUN yum -y install wget
RUN yum -y install httpd
RUN yum -y install --enablerepo=remi,remi-php71 php php-devel php-mbstring php-pdo php-gd php-xml php-mcrypt php-pgsql
 
#Thiet lap thu muc lam viec 
WORKDIR /var/www/html

#copy code tu thu muc code vao image
ADD ./code /var/www/html

# start httpd
CMD ["/usr/sbin/httpd", "-D", "FOREGROUND"]

EXPOSE 80

2. Build image
docker build -t httpd_sample .

3. T·∫°o v√† ch·∫°y container
docker run -d -p 80:80 httpd_sample

-----------------------------------------------------------------------------------------------------------------

B√†i 28: DevOps Docker 4 / Docker-compose docker n√¢ng cao

Dockerfile l√† g√¨
L√† file config d√πng ƒë·ªÉ build c√°c image m·ªõi d·ª±a tr√™n m·ªôt image c√≥ s·∫µn

C√°c l·ªánh trong Dockerfile
FROM: L·∫•y 1 image tr√™n docker hub
LABEL: Th√¥ng tin ng∆∞·ªùi b·∫£o tr√¨ dockerfile
ENV: thi·∫øt l·∫≠p m·ªôt bi·∫øn m√¥i tr∆∞·ªùng
RUN: Ch·ªâ ch·∫°y khi build image, ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ c√†i ƒë·∫∑t c√°c package v√†o container
COPY: Sao ch√©p c√°c file v√† th∆∞ m·ª•c v√†o container
ADD: Sao ch√©p c√°c file v√† th∆∞ m·ª•c v√†o container
CMD: trong 1 Dockerfile ch·ªâ c√≥ 1 CMD, ch·ªâ ch·∫°y khi th·ª±c hi·ªán l·ªán docker run ƒë·ªÉ t·∫°o ra 1 container
WORKDIR: Thi·∫øt l·∫≠p th∆∞ m·ª•c l√†m vi·ªác cho c√°c ch·ªâ th·ªã kh√°c nh∆∞: RUN, CMD, ENTRYPOINT, COPY, ADD,‚Ä¶
ARG: ƒê·ªãnh nghƒ©a gi√° tr·ªã bi·∫øn ƒë∆∞·ª£c d√πng trong l√∫c build image
ENTRYPOINT: cung c·∫•p l·ªánh v√† ƒë·ªëi s·ªë cho m·ªôt container th·ª±c thi
EXPOSE: khai b√°o port l·∫Øng nghe c·ªßa image
VOLUME: t·∫°o m·ªôt ƒëi·ªÉm g·∫Øn th∆∞ m·ª•c ƒë·ªÉ truy c·∫≠p v√† l∆∞u tr·ªØ data.

-----------------------------------------------------------------------------------------------------------------

B√†i 29: DevOps Docker 5 / Docker Volume, Networks docker n√¢ng cao

Lab document
http://tinhocthatladongian.com/downlo...

1. Docker volume
L√† m·ªôt n∆°i l∆∞u tr·ªØ data n·∫±m ngo√†i container, m·ª•c ƒë√≠ch kh√¥ng l√†m m·∫•t data khi x√≥a container

S·ª≠ d·ª•ng Volume khi n√†o 
- Khi chia s·∫ª d·ªØ li·ªáu gi·ªØa nhi·ªÅu container ƒëang ch·∫°y.
- L∆∞u d·ªØ li·ªáu t·ªõi m·ªôt server remote ho·∫∑c cloud.
- Khi c·∫ßn backup, restore ho·∫∑c migrate d·ªØ li·ªáu t·ª´ Docker Host n√†y sang Docker Host kh√°c.

L·ªánh li√™n quan t·ªõi volume
# docker volume create        T·∫°o m·∫°ng m·ªõi
# docker volume inspect       Xem chi ti·∫øt m·∫°ng
# docker volume ls             Hi·ªÉn th·ªã nh·ªØng m·∫°ng ƒëang c√≥
# docker volume rm             X√≥a volume
# docker volume prune         X√≥a to√†n b·ªô volume

2. Docker networks
ƒê·ªÉ k·∫øt n·ªëi c√°c container trong c√πng m·∫°ng ho·∫∑c kh√°c m·∫°ng v·ªõi nhau.

C√°c c√¢u l·ªánh thao t√°c v·ªõi m·∫°ng
# docker network create        T·∫°o m·∫°ng m·ªõi
# docker network inspect       Xem chi ti·∫øt m·∫°ng
# docker network ls             Hi·ªÉn th·ªã nh·ªØng m·∫°ng ƒëang c√≥
# docker network rm            X√≥a m·∫°ng
# docker network prune         X√≥a ƒë·ªìng lo·∫°t c√°c m·∫°ng kh√¥ng s·ª≠ d·ª•ng
# docker network connect       T·∫°o k·∫øt n·ªëi m·∫°ng
# docker network disconnect    Ng·∫Øt k·∫øt n·ªëi m·∫°ng

-----------------------------------------------------------------------------------------------------------------

B√†i 46: CI/CD How to install Jenkins on AWS EC2 Linux

1. EC2 installation
2. Java installation
$ yum install -y java-1.8.0-openjdk-devel.x86_64
$ alternatives --config java
$ java -version

3. Jenkins install
$ wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat/jenkins.repo
$ rpm --import https://pkg.jenkins.io/redhat/jenkins.io.key
$ yum install -y jenkins

4. Start Jenkins
$ systemctl start jenkins

5. Status Jenkins
$ service jenkins status 

6. Setting password
$ less /var/lib/jenkins/secrets/initialAdminPassword

Cai telnet: -> yum install telnet

-----------------------------------------------------------------------------------------------------------------

B√†i 47: Continuous Integration for PHP projects using Jenkins/GitHub

1. Web server installation
#!/bin/bash
yum update -y
yum install httpd -y
yum install git -y
amazon-linux-extras install epel
yum install epel-release
rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-7.rpm
yum install -y php70 php70-php php70-php-fpm php70-php-pecl-memcached php70-php-mysqlnd php70-php-xml
ln -s /usr/bin/php70 /usr/bin/php
service httpd start
chkconfig httpd on


2. Configure Apache
$ useradd www-user

$cd /var/www/html/
$mkdir employeemanager
$mkdir tinhocthatladongian
$chown -Rf www-user:apache tinhocthatladongian

$vi /etc/httpd/conf/httpd.conf

Listen 81
NameVirtualHost *:81
<VirtualHost *:81>
    DocumentRoot /var/www/html/employeemanager/
    <Directory "/var/www/html/employeemanager">
      Order deny,allow
      Allow from all
      AllowOverride All
      Require all granted
   </Directory>
</VirtualHost>


$service httpd restart

authorized_keys  id_rsa


3. Creating ssh key
$ sudo su - www-user
$ ssh-keygen -t rsa
$ cd /home/www-user/.ssh/
$ mv id_rsa.pub  

4. Copy private key to Jenkin server
cd /home
mkdir jenkins
vi web-key.pem
chown -Rf jenkins:root
chmod 400 web-key.pem

- Test connect to web server
vi /etc/passwd
jenkins:x:996:994:Jenkins Automation Server:/var/lib/jenkins:/bin/bash
su - jenkins
ssh www-user@[Web Server Address] -i /home/jenkins/web-key.pem 

5. Github configuration
Webhook
http://[Jenkin URL]:8080/github-webhook/ 

6. Jenkins configuration
6.1 Git configuration

6.2 Build Triggers
Check on "GitHub hook trigger for GITScm polling"

6.3 Build 
Execute shell

#!/bin/bash
ssh -T -i /home/jenkins/web-key.pem www-user@[Web Server Address] << EOF
cd /var/www/html/tinhocthatladongian
git pull
EOF

-----------------------------------------------------------------------------------------------------------------

B√†i 48: Jenkins ‚ûû GitLab ‚ûû PHP Continuous Integration

1. Jenkins installation
B√†i 46: CI/CD How to install Jenkins on AWS EC2 Linux
https://www.youtube.com/watch?v=v7tLaDJ-uqg

2. Web server apache installation
B√†i 47: Continuous Integration for PHP projects using Jenkins/GitHub
https://youtu.be/wPCQrN7PH3k

3. Gitlab
Git basic & Advand
https://www.youtube.com/watch?v=sXeiez_SGNI&list=PLjCpH2Qpki-uBzaBg447zIPNKyWJwPXYr

Creating repository & configuration

4. Jenkins configuration
- Install Flugin
GitLab
Gitlab Hook

http://13.212.15.8:8080/project/web-test-gitlab

5. Test

-----------------------------------------------------------------------------------------------------------------

B√†i 50: Jenkins‚ûû GitHub‚ûûJava maven ‚ûû Tomcat Continuous Integration

1. Jenkins installation
B√†i 46: CI/CD How to install Jenkins on AWS EC2 Linux
https://www.youtube.com/watch?v=v7tLaDJ-uqg

2. Web server apache installation
B√†i 47: Continuous Integration for PHP projects using Jenkins/GitHub
https://youtu.be/wPCQrN7PH3k

3. Tomcat Install
$ sudo yum install java-1.8.0-openjdk-devel
$ sudo yum install tomcat
$ sudo yum install tomcat-webapps tomcat-admin-webapps
$ sudo systemctl start tomcat
$ sudo systemctl enable tomcat
$ sudo systemctl stop tomcat

$ cd /etc/tomcat
$ cd /var/lib/tomcat/
$ chown -Rf www-user:tomcat webapps/

4. Maven installation
$ cd /usr/local/lib/
$ wget http://ftp.meisei-u.ac.jp/mirror/apache/dist/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gz
$ tar -xzvf apache-maven-3.6.3-bin.tar.gz
$ mv apache-maven-3.6.3 /opt
$ cd /opt/
$ sudo ln -s /opt/apache-maven-3.6.3 apache-maven
$ ls -l

5.Jenkins configuration
- Global Tool Configuration
Maven
/opt/apache-maven
/opt/apache-maven/bin/mvn -v

JDK
$locate openjdk
/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.242.b08-0.amzn2.0.1.x86_64/

- Project configuration
- Git
- Build/Invoke top-level Maven targets
clean
install
- Execute shell
scp -i /home/jenkins/web-server.pem /var/lib/jenkins/workspace/tinhocthatladongian-java/target/sparkjava-hello-world-1.0.war www-user@[Web Server Address]:/var/lib/tomcat/webapps

#!/bin/bash
ssh -T -i /home/jenkins/web-server.pem www-user@[Web Server Address] << EOF
sudo rm -Rf /var/lib/tomcat/webapps/sparkjava-hello-world-1.0
sudo service tomcat stop
sudo service tomcat start
EOF

6. GitHub
Webhook configuration

7. Test
http://[Web Server Address]:8080/sparkjava-hello-world-1.0/hello

-----------------------------------------------------------------------------------------------------------------

scp -i /home/jenkins/web-test-server.pem /var/lib/jenkins/workspace/sparkjava-web-test/target/sparkjava-hello-world-1.0.war www-user@13.212.15.8:/var/lib/tomcat/webapps

#!/bin/bash
ssh -T -i /home/jenkins/web-test-server.pem www-user@13.212.15.8 << EOF
sudo rm -Rf /var/lib/tomcat/webapps/sparkjava-hello-world-1.0
sudo service tomcat stop
sudo service tomcat start
EOF

-----------------------------------------------------------------------------------------------------------------

open the script in /etc/sudoers   -> sudo visudo

$ sudo visudo
## Now add the below lines in your sudoers file :
jenkins ALL=(ALL) NOPASSWD: ALL

$service jenkins start

------------------------------------------------------------------------------------------------------------------------

target/*.jar
/u01/apps/employee-api
/u01/apps/employee-api/start.sh

------------------------------------------------------------------------------------------------------------------------
ps -ef | grep java | grep employeemanager | awk '{print $2}' | xargs kill -9 || true

------------------------------------------------------------------------------------------------------------------------
 
scp -i /home/jenkins/bao-server.pem /var/lib/jenkins/workspace/employee-manager/target/employeemanager-0.0.1-SNAPSHOT.jar bao@18.136.107.224:/u01/apps/employee-api
#!/bin/bash
ssh -T -i /home/jenkins/bao-server.pem bao@18.136.107.224 << EOF
cd /u01/apps/employee-api
ps -ef | grep java | grep employeemanager | awk '{print $2}' | xargs -r kill || true
cd /u01/apps/employee-api
sh start-emloyee-api.sh
EOF

------------------------------------------------------------------------------------------------------------------------

PID=`ps -ef | grep java | grep employeemanager | awk '{print $2}'`
if [[ "" !=  "$PID" ]]; then
  echo "killing $PID"
  kill -9 $PID
fi

------------------------------------------------NGINX CONFIG-----------------------------------------------------------------
http {
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 4096;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    # Load modular configuration files from the /etc/nginx/conf.d directory.
    # See http://nginx.org/en/docs/ngx_core_module.html#include
    # for more information.
    include /etc/nginx/conf.d/*.conf;

    server {
        listen       80;
        listen       [::]:80;
        server_name  _;
        root         /usr/share/nginx/html/employee-manager-app;

        # Load configuration files for the default server block.
        include /etc/nginx/default.d/*.conf;

        error_page 404 /404.html;
        location = /404.html {
        }

        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
        }
    }
}

-----------------------------------------------------------------------------------------------------------------
start.sh of springboot


#ps -ef --sort=start_time | grep pva-bo-api | head -n 1 | awk '{print $2}' | xargs kill -9 || true
#sleep 5s
#nohup /u01/jdk1.8.0_241/bin/java -Xms256M -Xmx256M -XX:+UseG1GC -XX:+UseStringDeduplication -jar /u01/apps/rbac-pva-bo-api/pva-bo-api.jar --spring.profiles.active=uat --spring.config.additional-location=file:/application.yml,file:/application-uat.yml --logging.config=file:/logback-spring.xml --server.port=8180 > /dev/null 2>&1&
nohup java -jar /u01/apps/employee-api/employeemanager-0.0.1-SNAPSHOT.jar  --allowedOrigins=* --server.port=8180  > /dev/null 2>&1&

-Dspring.config.additional-location
--spring.config.additional-location



-----------------------------------------------------------------------------------------------------------------

